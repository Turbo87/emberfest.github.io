<h2>Tickets</h2>

{{#if controllers.user.isLoggedIn}}
    {{#if controller.model.length}}
        <table>
            <thead>
            <tr>
                <th>Ticket Type</th>
                <th width="150">Price</th>
                <th width="200">&nbsp;</th>
            </tr>
            </thead>
            <tbody>
            {{#each ticketType in controller}}
                <tr>
                    <td>
                        <p class="title">{{ticketType.name}}</p>
                        {{ticketType.description}}
                    </td>
                    <td>${{ticketType.price}}</td>
                    {{#if ticket.availablFrom}}
                        Tickets are available from {{ticket.availableFrom}}
                    {{else}}
                        {{#if ticketType.ticketsAvailable}}
                            <td><button class="button small" {{action "addTicketTypeToBasket" ticketType}}>Add to Cart</button></td>
                        {{else}}
                            <td><button class="button small disabled">Sold Out</button></td>
                        {{/if}}
                    {{/if}}

                </tr>
            {{/each}}
        </table>


        {{#if basket}}
            <h2>Shopping Cart</h2>

            {{#if controller.ticketSubtotal}}
                <div class="text-right" style="width: 100%">
                    <td>
                        <form action="https://secure.quickpay.dk/form/" method="post">
                            <input type="hidden" name="protocol" value="7" />
                            <input type="hidden" name="msgtype" value="authorize" />
                            <input type="hidden" name="merchant" value="99839257" />
                            <input type="hidden" name="language" value="en" />
                            <input type="hidden" name="ordernumber" {{bind-attr value=controller.orderNumber}} />
                            <input type="hidden" name="amount" {{bind-attr value=controller.ticketSubtotal}} />
                            <input type="hidden" name="currency" value="EUR" />
                            <input type="hidden" name="continueurl" {{bind-attr value=controller.continueUrl}} />
                            <input type="hidden" name="cancelurl" {{bind-attr value=controller.continueUrl}} />
                            <input type="hidden" name="callbackurl" {{bind-attr value=controller.callbackUrl}} />
                            <input type="hidden" name="autocapture" value="0" />
                            <input type="hidden" name="cardtypelock" value="" />
                            <input type="hidden" name="splitpayment" value="1" />
                            <input type="hidden" name="md5check" {{bind-attr value=controller.ticketsMd5}} />
                            <button class="button small" >Purchase {{controller.numTickets}} Tickets for {{controller.ticketSubtotalEur}} &#x2771;</button>
                        </form>
                    </td>
                </div>
            {{/if}}

            <table style="width: 100%;">
                <thead>
                <tr>
                    <th>Ticket Name</th>
                    <th>Ticket Holder Name</th>
                    <th>Price</th>
                </tr>
                </thead>

                {{#each basketTicket in basket}}
                    <tr>
                        <td>{{basketTicket.name}}</td>
                        <td>
                            {{input type="text" value=basketTicket.ticketHolder placeholder="Name of Ticket Holder"}}
                        </td>
                        <td>
                            {{basketTicket.price}}<br />
                            <button class="button tiny" {{action "removeTicketFromBasket" basketTicket}}>Remove</button></td>
                    </tr>
                {{/each}}
            </table>
        {{/if}}
    {{else}}
        <p class="talkRow">We are working hard on finalizing the tickets! We are aiming at opening ticket sales on February 28th.</p>
    {{/if}}

{{else}}
    <p class="talkRow">You need to sign in to purchase tickets!</p>
    <a {{action "doLogIn"}} class="button small">Sign in with your email</a>
{{/if}}

